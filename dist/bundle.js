(()=>{"use strict";class e{constructor(e,t,n,r){this.templateElement=document.getElementById(e),this.hostElement=document.getElementById(t);const s=document.importNode(this.templateElement.content,!0);this.element=s.firstElementChild,r&&(this.element.id=r),this.attach(n)}attach(e){this.hostElement.insertAdjacentElement(e?"afterbegin":"beforeend",this.element)}}const t=e=>{let t=!0;return e.required&&(t=t&&0!==e.value.toString().trim().length),null!=e.minLength&&"string"==typeof e.value&&(t=t&&e.value.length>=e.minLength),null!=e.maxLength&&"string"==typeof e.value&&(t=t&&e.value.length<=e.maxLength),null!=e.min&&"number"==typeof e.value&&(t=t&&e.value>=e.min),null!=e.max&&"number"==typeof e.value&&(t=t&&e.value<=e.max),t};function n(e,t,n){const r=n.value;return{configurable:!0,get(){return r.bind(this)}}}var r;!function(e){e[e.Active=0]="Active",e[e.Finished=1]="Finished"}(r||(r={}));class s{constructor(e,t,n,r,s){this.id=e,this.title=t,this.description=n,this.people=r,this.status=s}}class i{constructor(){this.listeners=[]}addListener(e){this.listeners.push(e)}}class l extends i{constructor(){super(),this.projects=[]}static getInstance(){return this.instance||(this.instance=new l),this.instance}addProject(e,t,n){const i=new s(Math.random().toString(),e,t,n,r.Active);this.projects.push(i),this.updateListeners()}moveProject(e,t){const n=this.projects.find((t=>t.id===e));n&&n.status!==t&&(n.status=t,this.updateListeners())}updateListeners(){for(const e of this.listeners)e(this.projects.slice())}}const o=l.getInstance();class a extends e{constructor(){super("project-input","app",!0,"user-input"),this.titleInputElement=this.element.querySelector("#title"),this.descriptionInputElement=this.element.querySelector("#description"),this.peopleInputElement=this.element.querySelector("#people"),this.configure()}configure(){this.element.addEventListener("submit",this.submitHandler)}renderContent(){}gatherUserInput(){const e=this.titleInputElement.value,n=this.descriptionInputElement.value,r=this.peopleInputElement.value,s={value:n,required:!0,minLength:5},i={value:+r,required:!0,min:1,max:5};return t({value:e,required:!0})&&t(s)&&t(i)?[e,n,+r]:void alert("Invalid input, please try again")}clearInputs(){this.titleInputElement.value="",this.descriptionInputElement.value="",this.peopleInputElement.value=""}submitHandler(e){e.preventDefault();const t=this.gatherUserInput();if(Array.isArray(t)){const[e,n,r]=t;o.addProject(e,n,r),this.clearInputs()}}}!function(e,t,n,r){var s,i=arguments.length,l=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(l=(i<3?s(l):i>3?s(t,n,l):s(t,n))||l);i>3&&l&&Object.defineProperty(t,n,l)}([n],a.prototype,"submitHandler",null);class c extends e{get persons(){return 1===this.project.people?"1 person":`${this.project.people} persons`}constructor(e,t){super("single-project",e,!1,t.id),this.project=t,this.configure(),this.renderContent()}dragStartHandler(e){e.dataTransfer.setData("text/plain",this.project.id),e.dataTransfer.effectAllowed="move"}dragEndHandler(e){console.log("DragEnd")}configure(){this.element.addEventListener("dragstart",this.dragStartHandler),this.element.addEventListener("dragend",this.dragEndHandler)}renderContent(){this.element.querySelector("h2").textContent=this.project.title,this.element.querySelector("h3").textContent=this.persons+" assigned",this.element.querySelector("p").textContent=this.project.description}}!function(e,t,n,r){var s,i=arguments.length,l=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(l=(i<3?s(l):i>3?s(t,n,l):s(t,n))||l);i>3&&l&&Object.defineProperty(t,n,l)}([n],c.prototype,"dragStartHandler",null);var d=function(e,t,n,r){var s,i=arguments.length,l=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(l=(i<3?s(l):i>3?s(t,n,l):s(t,n))||l);return i>3&&l&&Object.defineProperty(t,n,l),l};class p extends e{constructor(e){super("project-list","app",!1,`${e}-projects`),this.type=e,this.assignedProjects=[],this.configure(),this.renderContent()}dragOverHandler(e){e.dataTransfer&&"text/plain"===e.dataTransfer.types[0]&&(e.preventDefault(),this.element.querySelector("ul").classList.add("droppable"))}dropHandler(e){const t=e.dataTransfer.getData("text/plain");o.moveProject(t,"active"===this.type?r.Active:r.Finished)}dragLeaveHandler(e){this.element.querySelector("ul").classList.remove("droppable")}configure(){this.element.addEventListener("dragover",this.dragOverHandler),this.element.addEventListener("dragleave",this.dragLeaveHandler),this.element.addEventListener("drop",this.dropHandler),o.addListener((e=>{const t=e.filter((e=>"active"===this.type?e.status===r.Active:e.status===r.Finished));this.assignedProjects=t,this.renderProjects()}))}renderContent(){const e=`${this.type}-projects-list`;this.element.querySelector("ul").id=e,this.element.querySelector("h2").textContent=this.type.toUpperCase()+" PROJECTS"}renderProjects(){document.getElementById(`${this.type}-projects-list`).innerHTML="";for(const e of this.assignedProjects)new c(this.element.querySelector("ul").id,e)}}d([n],p.prototype,"dragOverHandler",null),d([n],p.prototype,"dropHandler",null),d([n],p.prototype,"dragLeaveHandler",null),new a,new p("active"),new p("finished")})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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ZHpELEtBQUtrRyxLQUFvQmpFLEVBQWNxQixPQUFTckIsRUFBY3lFLFNBQ3RHLENBR0FDLGlCQUFpQmpGLEdBQ0UxQixLQUFLUSxRQUFRMEQsY0FBYyxNQUNuQ29DLFVBQVVNLE9BQU8sWUFDNUIsQ0FFQXZDLFlBRUlyRSxLQUFLUSxRQUFROEQsaUJBQWlCLFdBQVl0RSxLQUFLb0csaUJBQy9DcEcsS0FBS1EsUUFBUThELGlCQUFpQixZQUFhdEUsS0FBSzJHLGtCQUNoRDNHLEtBQUtRLFFBQVE4RCxpQkFBaUIsT0FBUXRFLEtBQUt3RyxhQUUzQzFDLEVBQWFyQixhQUFhSyxJQUV0QixNQUFNK0QsRUFBbUIvRCxFQUFTZ0UsUUFBT25ELEdBQ25CLFdBQWQzRCxLQUFLa0csS0FDRXZDLEVBQVFyQixTQUFXTCxFQUFjcUIsT0FFckNLLEVBQVFyQixTQUFXTCxFQUFjeUUsV0FHNUMxRyxLQUFLbUcsaUJBQW1CVSxFQUN4QjdHLEtBQUsrRyxnQkFBZ0IsR0FFN0IsQ0FFQXZDLGdCQUNJLE1BQU13QyxFQUFTLEdBQUdoSCxLQUFLa0cscUJBQ3ZCbEcsS0FBS1EsUUFBUTBELGNBQWMsTUFBT3hELEdBQUtzRyxFQUN2Q2hILEtBQUtRLFFBQVEwRCxjQUFjLE1BQU84QixZQUFjaEcsS0FBS2tHLEtBQUtlLGNBQWdCLFdBQzlFLENBRVFGLGlCQUNnQjdHLFNBQVNDLGVBQWUsR0FBR0gsS0FBS2tHLHNCQUN4Q2dCLFVBQVksR0FDeEIsSUFBSyxNQUFNQyxLQUFlbkgsS0FBS21HLGlCQUMzQixJQUFJYixFQUFZdEYsS0FBS1EsUUFBUTBELGNBQWMsTUFBT3hELEdBQUl5RyxFQUU5RCxFQXBEQSxHQURDMUYsRyxvQ0FVRCxHQURDQSxHLGdDQU9ELEdBRENBLEcscUNDL0JMLElBQUl1QyxFQUNKLElBQUlpQyxFQUFZLFVBQ2hCLElBQUlBLEVBQVksVyIsInNvdXJjZXMiOlsid2VicGFjazovL3VuZGVyc3RhbmRpbmctdHlwZXNjcmlwdC8uL3NyYy9jb21wb25lbnRzL2Jhc2UtY29tcG9uZW50LnRzIiwid2VicGFjazovL3VuZGVyc3RhbmRpbmctdHlwZXNjcmlwdC8uL3NyYy91dGlsL3ZhbGlkYXRpb24udHMiLCJ3ZWJwYWNrOi8vdW5kZXJzdGFuZGluZy10eXBlc2NyaXB0Ly4vc3JjL2RlY29yYXRvcnMvYXV0b2JpbmQudHMiLCJ3ZWJwYWNrOi8vdW5kZXJzdGFuZGluZy10eXBlc2NyaXB0Ly4vc3JjL21vZGVscy9wcm9qZWN0LnRzIiwid2VicGFjazovL3VuZGVyc3RhbmRpbmctdHlwZXNjcmlwdC8uL3NyYy9zdGF0ZS9wcm9qZWN0LXN0YXRlLnRzIiwid2VicGFjazovL3VuZGVyc3RhbmRpbmctdHlwZXNjcmlwdC8uL3NyYy9jb21wb25lbnRzL3Byb2plY3QtaW5wdXQudHMiLCJ3ZWJwYWNrOi8vdW5kZXJzdGFuZGluZy10eXBlc2NyaXB0Ly4vc3JjL2NvbXBvbmVudHMvcHJvamVjdC1pdGVtLnRzIiwid2VicGFjazovL3VuZGVyc3RhbmRpbmctdHlwZXNjcmlwdC8uL3NyYy9jb21wb25lbnRzL3Byb2plY3QtbGlzdC50cyIsIndlYnBhY2s6Ly91bmRlcnN0YW5kaW5nLXR5cGVzY3JpcHQvLi9zcmMvYXBwLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvbXBvbmVudCBCYXNlIENsYXNzID0+IEEgY2xhc3MgdGhhdCBtYW5hZ2VzIGFsbCB0aGUgc2hhcmVkIGZ1bmN0aW9uYWxpdGllcyB3aGljaCB0aGUgY2xhc3NlcyB0aGF0IHJlbmRlcnMgdGhpbmdzIHRvIHRoZSBET00gaGF2ZSBpbiBjb21tb24uXG5leHBvcnQgZGVmYXVsdCBhYnN0cmFjdCBjbGFzcyBDb21wb25lbnQ8VCBleHRlbmRzIEhUTUxFbGVtZW50LCBVIGV4dGVuZHMgSFRNTEVsZW1lbnQ+IHsgLy8gVGhpbmsgb2YgdGhpcyBhcyBVSSBjb21wb25lbnRzIHRoYXQgd2UgcmVuZGVyIHRvIHRoZSBzY3JlZW4uIEFic3RyYWN0IGNsYXNzIGJlY2F1c2UgaXQgc2hvdWxkIG5ldmVyIGJlIGRpcmVjdGx5IGluc3RhbnRpYXRlZCwgaW5zdGVhZCwgaXQgc2hvdWxkIGFsd2F5cyBiZSB1c2VkIGZvciBpbmhlcml0YW5jZS5cbiAgICAvLyBXZSBjYW4gdXNlIGEgR2VuZXJpYyBjbGFzcyBoZXJlIHNvIHdlIGNhbiBzZXQgdGhlIGNvbmNyZXRlIHR5cGVzIHdoZW4gd2UgaW5oZXJpdCBmcm9tIGl0LlxuICAgIHRlbXBsYXRlRWxlbWVudDogSFRNTFRlbXBsYXRlRWxlbWVudDtcbiAgICBob3N0RWxlbWVudDogVDtcbiAgICBlbGVtZW50OiBVO1xuXG4gICAgY29uc3RydWN0b3IodGVtcGxhdGVJZDogc3RyaW5nLCBob3N0RWxlbWVudElkOiBzdHJpbmcsIGluc2VydEF0U3RhcnQ6IGJvb2xlYW4sIG5ld0VsZW1lbnRJZD86IHN0cmluZykgeyAvLyBXZSBuZWVkIHRvIGtub3cgdGhlIElEIG9mIHRoZSB0ZW1wbGF0ZSBzbyB3ZSBjYW4ga25vdyBob3cgdG8gc2VsZWN0IGl0LiBXZSBuZWVkIHRvIGtub3cgdGhlIGhvc3RFbGVtZW50SUQgc28gd2UgY2FuIGtub3cgd2hlcmUgdG8gcmVuZGVyIHRoaXMgY29tcG9uZW50LiBXZSBuZWVkIHRvIGtub3cgdGhlIG5ld0VsZW1lbnRJZCBzbyB0aGF0IHdlIGdldCBhbiBJRCB0aGF0IGhhcyB0byBiZSBhc3NpZ25lZCB0byB0aGUgbmV3bHkgcmVuZGVyZWQgZWxlbWVudC5cbiAgICAgICAgdGhpcy50ZW1wbGF0ZUVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0ZW1wbGF0ZUlkKSEgYXMgSFRNTFRlbXBsYXRlRWxlbWVudDtcbiAgICAgICAgdGhpcy5ob3N0RWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGhvc3RFbGVtZW50SWQpISBhcyBUO1xuXG4gICAgICAgIGNvbnN0IGltcG9ydGVkTm9kZSA9IGRvY3VtZW50LmltcG9ydE5vZGUodGhpcy50ZW1wbGF0ZUVsZW1lbnQuY29udGVudCwgdHJ1ZSk7IC8vIFdpdGggdGhpcywgd2UgaW1wb3J0IHRoZSB0ZW1wbGF0ZSBlbGVtZW50IGludG8gdGhlIERPTS4gVGhlIHNlY29uZCBhcmd1bWVudCBkZWZpbmVzIHdoZXRoZXIgd2Ugc2hvdWxkIGltcG9ydCB0aGlzIHdpdGggYSBkZWVwIGNsb25lIG9yIG5vdC5cbiAgICAgICAgdGhpcy5lbGVtZW50ID0gaW1wb3J0ZWROb2RlLmZpcnN0RWxlbWVudENoaWxkIGFzIFU7IC8vIEdldHRpbmcgYWNjZXNzIHRvIHRoZSBmb3JtIGVsZW1lbnQuXG4gICAgICAgIGlmIChuZXdFbGVtZW50SWQpIHtcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5pZCA9IG5ld0VsZW1lbnRJZDtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuYXR0YWNoKGluc2VydEF0U3RhcnQpO1xuICAgIH1cblxuICAgIHByaXZhdGUgYXR0YWNoKGluc2VydEF0U3RhcnQ6IGJvb2xlYW4pIHtcbiAgICAgICAgdGhpcy5ob3N0RWxlbWVudC5pbnNlcnRBZGphY2VudEVsZW1lbnQoaW5zZXJ0QXRTdGFydCA/ICdhZnRlcmJlZ2luJyA6ICdiZWZvcmVlbmQnLCB0aGlzLmVsZW1lbnQpO1xuICAgIH1cblxuICAgIC8vIEFkZGVkIGFzIEFCU1RSQUNUIG1ldGhvZHMgd2hpY2ggbWVhbnMgdGhlIGNvbXBsZXRlIGltcGxlbWVudGF0aW9uIGlzIG1pc2luZyBoZXJlLCBidXQgd2Ugbm93IGZvcmNlIGFueSBjbGFzcyBpbmhlcml0aW5nIGZyb20gdGhpcyBDb21wb25lbnQgY2xhc3MgdG8gaGF2ZSB0aGVzZSB0d28gbWV0aG9kcyBhdmFpbGFibGUgdG8gdGhlbS5cbiAgICBhYnN0cmFjdCBjb25maWd1cmUoKTogdm9pZDtcbiAgICBhYnN0cmFjdCByZW5kZXJDb250ZW50KCk6IHZvaWQ7XG59IiwiLy8gVmFsaWRhdGlvblxuZXhwb3J0IGludGVyZmFjZSBWYWxpZGF0YWJsZSB7XG4gICAgdmFsdWU6IHN0cmluZyB8IG51bWJlcjtcbiAgICByZXF1aXJlZD86IGJvb2xlYW47IC8vID8gaW4gZnJvbnQgb2YgdGhlIHByb3BlcnRpZXMgZGVub3RlcyB0aGF0IHRoZXNlIHZhbGVzIHNob3VsZCBhbGwgYmUgb3B0aW9uYWxcbiAgICBtaW5MZW5ndGg/OiBudW1iZXI7XG4gICAgbWF4TGVuZ3RoPzogbnVtYmVyO1xuICAgIG1pbj86IG51bWJlcjtcbiAgICBtYXg/OiBudW1iZXI7XG59XG5cbmV4cG9ydCBjb25zdCB2YWxpZGF0ZSA9ICh2YWxpZGF0YWJsZUlucHV0OiBWYWxpZGF0YWJsZSkgPT4ge1xuICAgIGxldCBpc1ZhbGlkID0gdHJ1ZTtcbiAgICBpZiAodmFsaWRhdGFibGVJbnB1dC5yZXF1aXJlZCkge1xuICAgICAgICBpc1ZhbGlkID0gaXNWYWxpZCAmJiB2YWxpZGF0YWJsZUlucHV0LnZhbHVlLnRvU3RyaW5nKCkudHJpbSgpLmxlbmd0aCAhPT0gMDtcbiAgICB9XG4gICAgaWYgKHZhbGlkYXRhYmxlSW5wdXQubWluTGVuZ3RoICE9IG51bGwgJiYgdHlwZW9mIHZhbGlkYXRhYmxlSW5wdXQudmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIGlzVmFsaWQgPSBpc1ZhbGlkICYmIHZhbGlkYXRhYmxlSW5wdXQudmFsdWUubGVuZ3RoID49IHZhbGlkYXRhYmxlSW5wdXQubWluTGVuZ3RoO1xuICAgIH1cbiAgICBpZiAodmFsaWRhdGFibGVJbnB1dC5tYXhMZW5ndGggIT0gbnVsbCAmJiB0eXBlb2YgdmFsaWRhdGFibGVJbnB1dC52YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgaXNWYWxpZCA9IGlzVmFsaWQgJiYgdmFsaWRhdGFibGVJbnB1dC52YWx1ZS5sZW5ndGggPD0gdmFsaWRhdGFibGVJbnB1dC5tYXhMZW5ndGg7XG4gICAgfVxuICAgIGlmICh2YWxpZGF0YWJsZUlucHV0Lm1pbiAhPSBudWxsICYmIHR5cGVvZiB2YWxpZGF0YWJsZUlucHV0LnZhbHVlID09PSAnbnVtYmVyJykge1xuICAgICAgICBpc1ZhbGlkID0gaXNWYWxpZCAmJiB2YWxpZGF0YWJsZUlucHV0LnZhbHVlID49IHZhbGlkYXRhYmxlSW5wdXQubWluO1xuICAgIH1cbiAgICBpZiAodmFsaWRhdGFibGVJbnB1dC5tYXggIT0gbnVsbCAmJiB0eXBlb2YgdmFsaWRhdGFibGVJbnB1dC52YWx1ZSA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgaXNWYWxpZCA9IGlzVmFsaWQgJiYgdmFsaWRhdGFibGVJbnB1dC52YWx1ZSA8PSB2YWxpZGF0YWJsZUlucHV0Lm1heDtcbiAgICB9XG4gICAgcmV0dXJuIGlzVmFsaWQ7XG59XG4iLCIvLyBBdXRvQmluZCBEZWNvcmF0b3JcbmV4cG9ydCBmdW5jdGlvbiBhdXRvYmluZChfOiBhbnksIF8yOiBzdHJpbmcsIGRlc2NyaXB0b3I6IFByb3BlcnR5RGVzY3JpcHRvcikge1xuICAgIGNvbnN0IG9yaWdpbmFsTWV0aG9kID0gZGVzY3JpcHRvci52YWx1ZTtcbiAgICBjb25zdCBhZGp1c3RlZERlc2NyaXB0b3I6IFByb3BlcnR5RGVzY3JpcHRvciA9IHtcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgICBnZXQoKSB7XG4gICAgICAgICAgICBjb25zdCBib3VuZEZuID0gb3JpZ2luYWxNZXRob2QuYmluZCh0aGlzKTtcbiAgICAgICAgICAgIHJldHVybiBib3VuZEZuO1xuICAgICAgICB9XG4gICAgfTtcbiAgICByZXR1cm4gYWRqdXN0ZWREZXNjcmlwdG9yO1xufVxuIiwiLy8gUHJvamVjdCBUeXBlXG5leHBvcnQgZW51bSBQcm9qZWN0U3RhdHVzIHsgQWN0aXZlLCBGaW5pc2hlZCB9IC8vIFVzaW5nIGVudW0gaGVyZSBiZWN1YXNlIHdlIGhhdmUgZXhhY3RseSAyIG9wdGlvbnMgYW5kIHdlIG9ubHkgbmVlZCBpZGVudGlmaWVycyBpbnN0ZWFkIG9mIHN0cmluZ3NcblxuZXhwb3J0IGNsYXNzIFByb2plY3QgeyAvLyBVc2luZyBhIGNsYXNzIHRvIGNyZWF0ZSB0aGUgUHJvamVjdCB0eXBlIGhlcmUgaW5zdGVhZCBvZiBhbiBpbnRlcmZhY2Ugb3IgYSBjdXN0b20gdHlwZSBiZWNhdXNlIHdlIHdhbnQgdG8gYmUgYWJsZSB0byBpbnN0YW50aWF0ZSBpdC5cbiAgICBjb25zdHJ1Y3RvcihwdWJsaWMgaWQ6IHN0cmluZywgcHVibGljIHRpdGxlOiBzdHJpbmcsIHB1YmxpYyBkZXNjcmlwdGlvbjogc3RyaW5nLCBwdWJsaWMgcGVvcGxlOiBudW1iZXIsIHB1YmxpYyBzdGF0dXM6IFByb2plY3RTdGF0dXMpIHsgfVxufVxuIiwiaW1wb3J0IHsgUHJvamVjdCwgUHJvamVjdFN0YXR1cyB9IGZyb20gXCIuLi9tb2RlbHMvcHJvamVjdFwiO1xuXG4vLyBQcm9qZWN0IFN0YXRlIE1hbmFnZW1lbnQgQ2xhc3M6IFRha2VzIGNhcmUgb2YgdGhlIHN0YXRlIG9mIHRoZSBhcHBsaWNhdGlvbiwgc2V0IHVwIGxpc3RlbmVycyBpbiB0aGUgZGlmZmVyZW50IHBhcnRzIG9mIHRoZSBhcHAgdGhhdCBtaWdodCBiZSBpbnRlcmVzdGVkLlxuXG50eXBlIExpc3RlbmVyPFQ+ID0gKGl0ZW1zOiBUW10pID0+IHZvaWQgLy8gVXNpbmcgYSB0eXBlIGhlcmUgYmVjYXVzZSB3ZSB3YW50IHRvIGVuY29kZSBhIGZ1bmN0aW9uIHR5cGUgd2l0aCBvbmUgd29yZC4gTGlzdGVuZXIgaXMganVzdCBhIGJ1bmNoIG9mIGZ1bmN0aW9ucyBhbmQgd2UgZXhlY3V0ZSB0aGF0IHdoZW4gYW55dGhpbmcgY2hhbmdlcy4gU2luY2UgaXQncyBhIGZ1bmN0aW9uIHdlIGhhdmUgdG8gZGVjbGFyZSBhIHJldHVybiB0eXBlIHdoaWNoIGlzIHZvaWQuXG5cbmNsYXNzIFN0YXRlPFQ+IHtcbiAgICBwcm90ZWN0ZWQgbGlzdGVuZXJzOiBMaXN0ZW5lcjxUPltdID0gW107IC8vIFNldCB1cCBhIHN1YnNjcmlwdGlvbiBwYXR0ZXJuIHRoYXQgbWFuYWdlcyBhIGxpc3Qgb2YgbGlzdGVuZXJzKGZ1bmN0aW9ucykgaW5zaWRlIG9mIHRoZSBwcm9qZWN0IHN0YXRlLiBGdW5jdGlvbnMgY2FsbGVkIHdoZW5ldmVyIHNvbWV0aGluZyBjaGFuZ2VzXG5cbiAgICBhZGRMaXN0ZW5lcihsaXN0ZW5lckZuOiBMaXN0ZW5lcjxUPikge1xuICAgICAgICB0aGlzLmxpc3RlbmVycy5wdXNoKGxpc3RlbmVyRm4pO1xuICAgIH1cbn1cblxuZXhwb3J0IGNsYXNzIFByb2plY3RTdGF0ZSBleHRlbmRzIFN0YXRlPFByb2plY3Q+IHtcbiAgICBwcml2YXRlIHByb2plY3RzOiBQcm9qZWN0W10gPSBbXTtcbiAgICBwcml2YXRlIHN0YXRpYyBpbnN0YW5jZTogUHJvamVjdFN0YXRlO1xuXG4gICAgcHJpdmF0ZSBjb25zdHJ1Y3RvcigpIHsgLy8gQ3JlYXRpbmcgYSBwcml2YXRlIGNvbnN0cnVjdG9yIGhlcmUgZ3VhcmFudGVlcyB0aGF0IHRoaXMgaXMgYSBzaW5nbGV0b24gY2xhc3MuXG4gICAgICAgIHN1cGVyKCk7XG4gICAgfVxuXG4gICAgc3RhdGljIGdldEluc3RhbmNlKCkgeyAvLyBDcmVhdGluZyBhIG5ldyBpbnN0YW5jZSBvZiBQcm9qZWN0U3RhdGVcbiAgICAgICAgaWYgKHRoaXMuaW5zdGFuY2UpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmluc3RhbmNlO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuaW5zdGFuY2UgPSBuZXcgUHJvamVjdFN0YXRlKCk7XG4gICAgICAgIHJldHVybiB0aGlzLmluc3RhbmNlO1xuICAgIH1cblxuICAgIGFkZFByb2plY3QodGl0bGU6IHN0cmluZywgZGVzY3JpcHRpb246IHN0cmluZywgbnVtYmVyT2ZQZW9wbGU6IG51bWJlcikge1xuICAgICAgICBjb25zdCBuZXdQcm9qZWN0ID0gbmV3IFByb2plY3QoTWF0aC5yYW5kb20oKS50b1N0cmluZygpLCB0aXRsZSwgZGVzY3JpcHRpb24sIG51bWJlck9mUGVvcGxlLCBQcm9qZWN0U3RhdHVzLkFjdGl2ZSlcbiAgICAgICAgdGhpcy5wcm9qZWN0cy5wdXNoKG5ld1Byb2plY3QpO1xuICAgICAgICB0aGlzLnVwZGF0ZUxpc3RlbmVycygpO1xuICAgIH1cblxuICAgIG1vdmVQcm9qZWN0KHByb2plY3RJZDogc3RyaW5nLCBuZXdTdGF0dXM6IFByb2plY3RTdGF0dXMpIHtcbiAgICAgICAgY29uc3QgcHJvamVjdCA9IHRoaXMucHJvamVjdHMuZmluZChwcm9qZWN0ID0+IHByb2plY3QuaWQgPT09IHByb2plY3RJZCk7XG4gICAgICAgIGlmIChwcm9qZWN0ICYmIHByb2plY3Quc3RhdHVzICE9PSBuZXdTdGF0dXMpIHtcbiAgICAgICAgICAgIHByb2plY3Quc3RhdHVzID0gbmV3U3RhdHVzO1xuICAgICAgICAgICAgdGhpcy51cGRhdGVMaXN0ZW5lcnMoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgdXBkYXRlTGlzdGVuZXJzKCkge1xuICAgICAgICBmb3IgKGNvbnN0IGxpc3RlbmVyRm4gb2YgdGhpcy5saXN0ZW5lcnMpIHtcbiAgICAgICAgICAgIGxpc3RlbmVyRm4odGhpcy5wcm9qZWN0cy5zbGljZSgpKTsgLy8gQ2FsbGluZyBzbGljZSgpIG1ha2VzIHN1cmUgd2Ugb25seSByZXR1cm4gYSBjb3B5IG9mIHRoZSBhcnJheSBhbmQgbm90IHRoZSBvcmlnaW5hbCBhcnJheS4gQmVjYXVzZSBhcnJheXMgYXJlIHBhc3NlZCBieSByZWZlcmVuY2UgaW4gSlNcbiAgICAgICAgfVxuICAgIH1cbn1cblxuLy8gQ3JlYXRpbmcgYSBHbG9iYWwgSW5zdGFuY2Ugb2YgUHJvamVjdHMgU3RhdGUuIEJ5IGRvaW5nIHRoaXMsIHdlIGNhbiBub3cgY29tbXVuaWNhdGUgd2l0aCB0aGUgY2xhc3MgZnJvbSBhbnl3aGVyZSBpbiB0aGUgYXBwLCBldmVuIHRob3VnaCB0aGUgY2xhc3MgaXMgcHJpdmF0ZS5cbmV4cG9ydCBjb25zdCBwcm9qZWN0U3RhdGUgPSBQcm9qZWN0U3RhdGUuZ2V0SW5zdGFuY2UoKTsgLy8gV2l0aCB0aGlzIHdlJ3JlIGd1YXJhbnRlZWQgd2UncmUgb25seSB3b3JraW5nIHdpdGggdGhlIGV4YWN0IHNhbWUgb2JqZWN0IGFuZCB3ZSBhbHdheXMgaGF2ZSBvbmx5IG9uZSBvYmplY3Qgb2YgdGhhdCB0eXBlIGluIHRoZSBlbnRpcmUgYXBwbGljYXRpb24uIiwiaW1wb3J0IENvbXBvbmVudCBmcm9tICcuL2Jhc2UtY29tcG9uZW50JztcbmltcG9ydCAqIGFzIFZhbGlkYXRpb24gZnJvbSAnLi4vdXRpbC92YWxpZGF0aW9uJztcbmltcG9ydCB7IGF1dG9iaW5kIGFzIEF1dG9iaW5kIH0gZnJvbSAnLi4vZGVjb3JhdG9ycy9hdXRvYmluZCc7XG5pbXBvcnQgeyBwcm9qZWN0U3RhdGUgfSBmcm9tICcuLi9zdGF0ZS9wcm9qZWN0LXN0YXRlJztcblxuLy8gUHJvamVjdElucHV0IENsYXNzXG5leHBvcnQgY2xhc3MgUHJvamVjdElucHV0IGV4dGVuZHMgQ29tcG9uZW50PEhUTUxEaXZFbGVtZW50LCBIVE1MRm9ybUVsZW1lbnQ+IHtcbiAgICB0aXRsZUlucHV0RWxlbWVudDogSFRNTElucHV0RWxlbWVudDtcbiAgICBkZXNjcmlwdGlvbklucHV0RWxlbWVudDogSFRNTElucHV0RWxlbWVudDtcbiAgICBwZW9wbGVJbnB1dEVsZW1lbnQ6IEhUTUxJbnB1dEVsZW1lbnQ7XG5cbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgLy8gSGVyZSB3ZSBpbXBvcnQgdGhlIHRlbXBsYXRlRWxlbWVudCBpbnRvIHRoZSBET00uXG4gICAgICAgIHN1cGVyKCdwcm9qZWN0LWlucHV0JywgJ2FwcCcsIHRydWUsICd1c2VyLWlucHV0Jyk7XG5cbiAgICAgICAgLy8gR2V0dGluZyBBY2Nlc3MgdG8gYWxsIHRoZSBpbnB1dCBmaWVsZHMgb2YgdGhlIGZvcm0sIHNlbGVjdGluZyB0aGVtIHdpdGggdGhlIGlkIGF0dHJpYnV0ZS5cbiAgICAgICAgdGhpcy50aXRsZUlucHV0RWxlbWVudCA9IHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcjdGl0bGUnKSBhcyBIVE1MSW5wdXRFbGVtZW50O1xuICAgICAgICB0aGlzLmRlc2NyaXB0aW9uSW5wdXRFbGVtZW50ID0gdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJyNkZXNjcmlwdGlvbicpIGFzIEhUTUxJbnB1dEVsZW1lbnQ7XG4gICAgICAgIHRoaXMucGVvcGxlSW5wdXRFbGVtZW50ID0gdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJyNwZW9wbGUnKSBhcyBIVE1MSW5wdXRFbGVtZW50O1xuXG4gICAgICAgIHRoaXMuY29uZmlndXJlKCk7XG4gICAgfVxuXG4gICAgY29uZmlndXJlKCkge1xuICAgICAgICB0aGlzLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgdGhpcy5zdWJtaXRIYW5kbGVyKTtcbiAgICB9XG5cbiAgICByZW5kZXJDb250ZW50KCkgeyB9XG5cbiAgICBwcml2YXRlIGdhdGhlclVzZXJJbnB1dCgpOiBbc3RyaW5nLCBzdHJpbmcsIG51bWJlcl0gfCB2b2lkIHtcbiAgICAgICAgY29uc3QgZW50ZXJlZFRpdGxlID0gdGhpcy50aXRsZUlucHV0RWxlbWVudC52YWx1ZTtcbiAgICAgICAgY29uc3QgZW50ZXJlZERlc2NyaXB0aW9uID0gdGhpcy5kZXNjcmlwdGlvbklucHV0RWxlbWVudC52YWx1ZTtcbiAgICAgICAgY29uc3QgZW50ZXJlZFBlb3BsZSA9IHRoaXMucGVvcGxlSW5wdXRFbGVtZW50LnZhbHVlO1xuXG4gICAgICAgIGNvbnN0IHRpdGxlVmFsaWRhdGFibGU6IFZhbGlkYXRpb24uVmFsaWRhdGFibGUgPSB7XG4gICAgICAgICAgICB2YWx1ZTogZW50ZXJlZFRpdGxlLFxuICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWVcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGRlc2NyaXB0aW9uVmFsaWRhdGFibGU6IFZhbGlkYXRpb24uVmFsaWRhdGFibGUgPSB7XG4gICAgICAgICAgICB2YWx1ZTogZW50ZXJlZERlc2NyaXB0aW9uLFxuICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICAgICAgICBtaW5MZW5ndGg6IDVcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHBlb3BsZVZhbGlkYXRhYmxlOiBWYWxpZGF0aW9uLlZhbGlkYXRhYmxlID0ge1xuICAgICAgICAgICAgdmFsdWU6ICtlbnRlcmVkUGVvcGxlLFxuICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICAgICAgICBtaW46IDEsXG4gICAgICAgICAgICBtYXg6IDVcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghVmFsaWRhdGlvbi52YWxpZGF0ZSh0aXRsZVZhbGlkYXRhYmxlKSB8fCAhVmFsaWRhdGlvbi52YWxpZGF0ZShkZXNjcmlwdGlvblZhbGlkYXRhYmxlKSB8fCAhVmFsaWRhdGlvbi52YWxpZGF0ZShwZW9wbGVWYWxpZGF0YWJsZSkpIHtcbiAgICAgICAgICAgIGFsZXJ0KCdJbnZhbGlkIGlucHV0LCBwbGVhc2UgdHJ5IGFnYWluJyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gW2VudGVyZWRUaXRsZSwgZW50ZXJlZERlc2NyaXB0aW9uLCArZW50ZXJlZFBlb3BsZV07XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGNsZWFySW5wdXRzKCkge1xuICAgICAgICB0aGlzLnRpdGxlSW5wdXRFbGVtZW50LnZhbHVlID0gJyc7XG4gICAgICAgIHRoaXMuZGVzY3JpcHRpb25JbnB1dEVsZW1lbnQudmFsdWUgPSAnJztcbiAgICAgICAgdGhpcy5wZW9wbGVJbnB1dEVsZW1lbnQudmFsdWUgPSAnJztcbiAgICB9XG5cbiAgICBAQXV0b2JpbmRcbiAgICBwcml2YXRlIHN1Ym1pdEhhbmRsZXIoZXZlbnQ6IEV2ZW50KSB7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGNvbnN0IHVzZXJJbnB1dCA9IHRoaXMuZ2F0aGVyVXNlcklucHV0KCk7XG5cbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodXNlcklucHV0KSkge1xuICAgICAgICAgICAgY29uc3QgW3RpdGxlLCBkZXNjcmlwdGlvbiwgcGVvcGxlXSA9IHVzZXJJbnB1dDtcbiAgICAgICAgICAgIHByb2plY3RTdGF0ZS5hZGRQcm9qZWN0KHRpdGxlLCBkZXNjcmlwdGlvbiwgcGVvcGxlKTtcbiAgICAgICAgICAgIHRoaXMuY2xlYXJJbnB1dHMoKTtcbiAgICAgICAgfVxuICAgIH1cbn0iLCJpbXBvcnQgeyBEcmFnZ2FibGUgfSBmcm9tICcuLi9tb2RlbHMvZHJhZy1kcm9wJztcbmltcG9ydCB7IFByb2plY3QgfSBmcm9tICcuLi9tb2RlbHMvcHJvamVjdCc7XG5pbXBvcnQgQ29tcG9uZW50IGZyb20gJy4vYmFzZS1jb21wb25lbnQnO1xuaW1wb3J0IHsgYXV0b2JpbmQgfSBmcm9tICcuLi9kZWNvcmF0b3JzL2F1dG9iaW5kJztcblxuLy8gUHJvamVjdEl0ZW0gQ2xhc3NcbmV4cG9ydCBjbGFzcyBQcm9qZWN0SXRlbSBleHRlbmRzIENvbXBvbmVudDxIVE1MVUxpc3RFbGVtZW50LCBIVE1MTElFbGVtZW50PiBpbXBsZW1lbnRzIERyYWdnYWJsZSB7XG4gICAgcHJpdmF0ZSBwcm9qZWN0OiBQcm9qZWN0O1xuXG4gICAgZ2V0IHBlcnNvbnMoKSB7XG4gICAgICAgIGlmICh0aGlzLnByb2plY3QucGVvcGxlID09PSAxKSB7XG4gICAgICAgICAgICByZXR1cm4gJzEgcGVyc29uJztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBgJHt0aGlzLnByb2plY3QucGVvcGxlfSBwZXJzb25zYDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0cnVjdG9yKGhvc3RJZDogc3RyaW5nLCBwcm9qZWN0OiBQcm9qZWN0KSB7XG4gICAgICAgIHN1cGVyKCdzaW5nbGUtcHJvamVjdCcsIGhvc3RJZCwgZmFsc2UsIHByb2plY3QuaWQpO1xuICAgICAgICB0aGlzLnByb2plY3QgPSBwcm9qZWN0O1xuXG4gICAgICAgIHRoaXMuY29uZmlndXJlKCk7XG4gICAgICAgIHRoaXMucmVuZGVyQ29udGVudCgpO1xuICAgIH1cblxuICAgIEBhdXRvYmluZCAvLyBXZSdyZSBAYXV0b2JpbmQgaGVyZSB0byBtYWtlIHN1cmUgdGhhdCBcInRoaXNcIiBrZXl3b3JkIHJlZmVycyB0byB0aGUgUHJvamVjdEl0ZW0gY2xhc3MsIHdoaWNoIHdpbGwgbm90IGJlIHRoZSBjYXNlIGJ5IGRlZmF1bHRcbiAgICBkcmFnU3RhcnRIYW5kbGVyKGV2ZW50OiBEcmFnRXZlbnQpIHtcbiAgICAgICAgZXZlbnQuZGF0YVRyYW5zZmVyIS5zZXREYXRhKCd0ZXh0L3BsYWluJywgdGhpcy5wcm9qZWN0LmlkKTtcbiAgICAgICAgZXZlbnQuZGF0YVRyYW5zZmVyIS5lZmZlY3RBbGxvd2VkID0gJ21vdmUnO1xuICAgIH1cblxuICAgIGRyYWdFbmRIYW5kbGVyKF86IERyYWdFdmVudCkge1xuICAgICAgICBjb25zb2xlLmxvZygnRHJhZ0VuZCcpO1xuICAgIH1cblxuICAgIGNvbmZpZ3VyZSgpIHtcbiAgICAgICAgdGhpcy5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdzdGFydCcsIHRoaXMuZHJhZ1N0YXJ0SGFuZGxlcik7XG4gICAgICAgIHRoaXMuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdkcmFnZW5kJywgdGhpcy5kcmFnRW5kSGFuZGxlcik7XG4gICAgfVxuXG4gICAgcmVuZGVyQ29udGVudCgpIHtcbiAgICAgICAgdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ2gyJykhLnRleHRDb250ZW50ID0gdGhpcy5wcm9qZWN0LnRpdGxlO1xuICAgICAgICB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcignaDMnKSEudGV4dENvbnRlbnQgPSB0aGlzLnBlcnNvbnMgKyAnIGFzc2lnbmVkJztcbiAgICAgICAgdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ3AnKSEudGV4dENvbnRlbnQgPSB0aGlzLnByb2plY3QuZGVzY3JpcHRpb247XG4gICAgfVxufSIsImltcG9ydCB7IERyYWdUYXJnZXQgfSBmcm9tIFwiLi4vbW9kZWxzL2RyYWctZHJvcFwiO1xuaW1wb3J0IHsgUHJvamVjdCwgUHJvamVjdFN0YXR1cyB9IGZyb20gXCIuLi9tb2RlbHMvcHJvamVjdFwiO1xuaW1wb3J0IENvbXBvbmVudCBmcm9tIFwiLi9iYXNlLWNvbXBvbmVudFwiO1xuaW1wb3J0IHsgYXV0b2JpbmQgfSBmcm9tIFwiLi4vZGVjb3JhdG9ycy9hdXRvYmluZFwiO1xuaW1wb3J0IHsgcHJvamVjdFN0YXRlIH0gZnJvbSBcIi4uL3N0YXRlL3Byb2plY3Qtc3RhdGVcIjtcbmltcG9ydCB7IFByb2plY3RJdGVtIH0gZnJvbSAnLi9wcm9qZWN0LWl0ZW0nO1xuXG4vLyBQcm9qZWN0TGlzdCBDbGFzc1xuZXhwb3J0IGNsYXNzIFByb2plY3RMaXN0IGV4dGVuZHMgQ29tcG9uZW50PEhUTUxEaXZFbGVtZW50LCBIVE1MRWxlbWVudD4gaW1wbGVtZW50cyBEcmFnVGFyZ2V0IHtcbiAgICBhc3NpZ25lZFByb2plY3RzOiBQcm9qZWN0W107XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIHR5cGU6ICdhY3RpdmUnIHwgJ2ZpbmlzaGVkJykge1xuICAgICAgICBzdXBlcigncHJvamVjdC1saXN0JywgJ2FwcCcsIGZhbHNlLCBgJHt0eXBlfS1wcm9qZWN0c2ApO1xuICAgICAgICB0aGlzLmFzc2lnbmVkUHJvamVjdHMgPSBbXTtcblxuICAgICAgICB0aGlzLmNvbmZpZ3VyZSgpO1xuICAgICAgICB0aGlzLnJlbmRlckNvbnRlbnQoKTtcbiAgICB9XG5cbiAgICBAYXV0b2JpbmRcbiAgICBkcmFnT3ZlckhhbmRsZXIoZXZlbnQ6IERyYWdFdmVudCkge1xuICAgICAgICBpZiAoZXZlbnQuZGF0YVRyYW5zZmVyICYmIGV2ZW50LmRhdGFUcmFuc2Zlci50eXBlc1swXSA9PT0gJ3RleHQvcGxhaW4nKSB7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgY29uc3QgbGlzdEVsID0gdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ3VsJykhO1xuICAgICAgICAgICAgbGlzdEVsLmNsYXNzTGlzdC5hZGQoJ2Ryb3BwYWJsZScpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgQGF1dG9iaW5kXG4gICAgZHJvcEhhbmRsZXIoZXZlbnQ6IERyYWdFdmVudCkge1xuICAgICAgICBjb25zdCBwcm9qZWN0SWQgPSBldmVudC5kYXRhVHJhbnNmZXIhLmdldERhdGEoJ3RleHQvcGxhaW4nKTtcbiAgICAgICAgcHJvamVjdFN0YXRlLm1vdmVQcm9qZWN0KHByb2plY3RJZCwgdGhpcy50eXBlID09PSAnYWN0aXZlJyA/IFByb2plY3RTdGF0dXMuQWN0aXZlIDogUHJvamVjdFN0YXR1cy5GaW5pc2hlZCk7XG4gICAgfVxuXG4gICAgQGF1dG9iaW5kXG4gICAgZHJhZ0xlYXZlSGFuZGxlcihfOiBEcmFnRXZlbnQpIHtcbiAgICAgICAgY29uc3QgbGlzdEVsID0gdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ3VsJykhO1xuICAgICAgICBsaXN0RWwuY2xhc3NMaXN0LnJlbW92ZSgnZHJvcHBhYmxlJyk7XG4gICAgfVxuXG4gICAgY29uZmlndXJlKCkge1xuICAgICAgICAvLyBBZGQgYSBsaXN0ZW5lciB0byBtYWtlIHN1cmUgdGhhdCB0aGUgZHJhZ092ZXJIYW5kbGVyIGlzIGFjdHVhbGx5IGZpcmVkXG4gICAgICAgIHRoaXMuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdkcmFnb3ZlcicsIHRoaXMuZHJhZ092ZXJIYW5kbGVyKTtcbiAgICAgICAgdGhpcy5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdsZWF2ZScsIHRoaXMuZHJhZ0xlYXZlSGFuZGxlcik7XG4gICAgICAgIHRoaXMuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdkcm9wJywgdGhpcy5kcm9wSGFuZGxlcik7XG5cbiAgICAgICAgcHJvamVjdFN0YXRlLmFkZExpc3RlbmVyKChwcm9qZWN0czogUHJvamVjdFtdKSA9PiB7IC8vIFJlYWNoIG91dCB0byBwcm9qZWN0U3RhdGUgYW5kIGNhbGwgYWRkTGlzdGVuZXIgb24gaXQgdG8gcmVnaXN0ZXIgYSBsaXN0ZW5lciBmdW5jdGlvbi4gbGlzdGVuZXJzIGluIHRoZSBlbmQgaXMganVzdCBhIGxpc3Qgb2YgZnVuY3Rpb25zIHdoaWNoIHdlJ2xsIGV2ZW50dWFsbHkgY2FsbCB3aGVuIHNvbWV0aGluZyBjaGFuZ2VzLlxuICAgICAgICAgICAgLy8gQmVmb3JlIHdlIHN0b3JlIHRoZSBwcm9qZWN0cyBhbmQgcmVuZGVyIHRoZW0gd2Ugd2FubmEgZmlsdGVyIHRoZW0sIHRvIGtub3cgd2hpY2ggb25lcyBhcmUgYWN0aXZlIGFuZCBmaW5pc2hlZCByZXNwZWN0aXZlbHlcbiAgICAgICAgICAgIGNvbnN0IHJlbGV2YW50UHJvamVjdHMgPSBwcm9qZWN0cy5maWx0ZXIocHJvamVjdCA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMudHlwZSA9PT0gJ2FjdGl2ZScpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHByb2plY3Quc3RhdHVzID09PSBQcm9qZWN0U3RhdHVzLkFjdGl2ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHByb2plY3Quc3RhdHVzID09PSBQcm9qZWN0U3RhdHVzLkZpbmlzaGVkO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHRoaXMuYXNzaWduZWRQcm9qZWN0cyA9IHJlbGV2YW50UHJvamVjdHM7IC8vIE9uY2Ugc29tZXRoaW5nIGNoYW5nZXMsIG92ZXJyaWRlIHRoZSBhc3NpZ25lZFByb2plY3RzIHdpdGggdGhlIG5ldyBwcm9qZWN0cyBiZWNhdXNlIHNvbWV0aGluZyBjaGFuZ2VkIGluIHRoZSBzdGF0ZS5cbiAgICAgICAgICAgIHRoaXMucmVuZGVyUHJvamVjdHMoKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmVuZGVyQ29udGVudCgpIHtcbiAgICAgICAgY29uc3QgbGlzdElkID0gYCR7dGhpcy50eXBlfS1wcm9qZWN0cy1saXN0YDtcbiAgICAgICAgdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ3VsJykhLmlkID0gbGlzdElkO1xuICAgICAgICB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcignaDInKSEudGV4dENvbnRlbnQgPSB0aGlzLnR5cGUudG9VcHBlckNhc2UoKSArICcgUFJPSkVDVFMnO1xuICAgIH1cblxuICAgIHByaXZhdGUgcmVuZGVyUHJvamVjdHMoKSB7XG4gICAgICAgIGNvbnN0IGxpc3RFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYCR7dGhpcy50eXBlfS1wcm9qZWN0cy1saXN0YCkhIGFzIEhUTUxVTGlzdEVsZW1lbnQ7XG4gICAgICAgIGxpc3RFbGVtZW50LmlubmVySFRNTCA9ICcnOyAvLyBXZSBnZXQgdGhlIHJpZCBvZiBhbGwgbGlzdCBpdGVtcyBhbmQgdGhlbiByZS1yZW5kZXIuIFRoaXMgcHJldmVudHMgcmUtcmVuZGVyaW5nIG9mIHRoZSBvbGQgaXRlbXMgaW4gdGhlIGxpc3Qgd2hpY2ggbGVkIHRvIHNvbWUgaXRlbSBiZWluZyByZW5kZXJlZCB0d2ljZVxuICAgICAgICBmb3IgKGNvbnN0IHByb2plY3RJdGVtIG9mIHRoaXMuYXNzaWduZWRQcm9qZWN0cykge1xuICAgICAgICAgICAgbmV3IFByb2plY3RJdGVtKHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKCd1bCcpIS5pZCwgcHJvamVjdEl0ZW0pO1xuICAgICAgICB9XG4gICAgfVxufSIsImltcG9ydCB7IFByb2plY3RJbnB1dCB9IGZyb20gXCIuL2NvbXBvbmVudHMvcHJvamVjdC1pbnB1dFwiO1xuaW1wb3J0IHsgUHJvamVjdExpc3QgfSBmcm9tIFwiLi9jb21wb25lbnRzL3Byb2plY3QtbGlzdFwiO1xuXG5uZXcgUHJvamVjdElucHV0KCk7XG5uZXcgUHJvamVjdExpc3QoJ2FjdGl2ZScpO1xubmV3IFByb2plY3RMaXN0KCdmaW5pc2hlZCcpOyJdLCJuYW1lcyI6WyJDb21wb25lbnQiLCJjb25zdHJ1Y3RvciIsInRlbXBsYXRlSWQiLCJob3N0RWxlbWVudElkIiwiaW5zZXJ0QXRTdGFydCIsIm5ld0VsZW1lbnRJZCIsInRoaXMiLCJ0ZW1wbGF0ZUVsZW1lbnQiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiaG9zdEVsZW1lbnQiLCJpbXBvcnRlZE5vZGUiLCJpbXBvcnROb2RlIiwiY29udGVudCIsImVsZW1lbnQiLCJmaXJzdEVsZW1lbnRDaGlsZCIsImlkIiwiYXR0YWNoIiwiaW5zZXJ0QWRqYWNlbnRFbGVtZW50IiwidmFsaWRhdGUiLCJ2YWxpZGF0YWJsZUlucHV0IiwiaXNWYWxpZCIsInJlcXVpcmVkIiwidmFsdWUiLCJ0b1N0cmluZyIsInRyaW0iLCJsZW5ndGgiLCJtaW5MZW5ndGgiLCJtYXhMZW5ndGgiLCJtaW4iLCJtYXgiLCJhdXRvYmluZCIsIl8iLCJfMiIsImRlc2NyaXB0b3IiLCJvcmlnaW5hbE1ldGhvZCIsImNvbmZpZ3VyYWJsZSIsImdldCIsImJpbmQiLCJQcm9qZWN0U3RhdHVzIiwiUHJvamVjdCIsInRpdGxlIiwiZGVzY3JpcHRpb24iLCJwZW9wbGUiLCJzdGF0dXMiLCJTdGF0ZSIsImxpc3RlbmVycyIsImFkZExpc3RlbmVyIiwibGlzdGVuZXJGbiIsInB1c2giLCJQcm9qZWN0U3RhdGUiLCJzdXBlciIsInByb2plY3RzIiwic3RhdGljIiwiaW5zdGFuY2UiLCJhZGRQcm9qZWN0IiwibnVtYmVyT2ZQZW9wbGUiLCJuZXdQcm9qZWN0IiwiTWF0aCIsInJhbmRvbSIsIkFjdGl2ZSIsInVwZGF0ZUxpc3RlbmVycyIsIm1vdmVQcm9qZWN0IiwicHJvamVjdElkIiwibmV3U3RhdHVzIiwicHJvamVjdCIsImZpbmQiLCJzbGljZSIsInByb2plY3RTdGF0ZSIsImdldEluc3RhbmNlIiwiUHJvamVjdElucHV0IiwidGl0bGVJbnB1dEVsZW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiZGVzY3JpcHRpb25JbnB1dEVsZW1lbnQiLCJwZW9wbGVJbnB1dEVsZW1lbnQiLCJjb25maWd1cmUiLCJhZGRFdmVudExpc3RlbmVyIiwic3VibWl0SGFuZGxlciIsInJlbmRlckNvbnRlbnQiLCJnYXRoZXJVc2VySW5wdXQiLCJlbnRlcmVkVGl0bGUiLCJlbnRlcmVkRGVzY3JpcHRpb24iLCJlbnRlcmVkUGVvcGxlIiwiZGVzY3JpcHRpb25WYWxpZGF0YWJsZSIsInBlb3BsZVZhbGlkYXRhYmxlIiwiYWxlcnQiLCJjbGVhcklucHV0cyIsImV2ZW50IiwicHJldmVudERlZmF1bHQiLCJ1c2VySW5wdXQiLCJBcnJheSIsImlzQXJyYXkiLCJQcm9qZWN0SXRlbSIsInBlcnNvbnMiLCJob3N0SWQiLCJkcmFnU3RhcnRIYW5kbGVyIiwiZGF0YVRyYW5zZmVyIiwic2V0RGF0YSIsImVmZmVjdEFsbG93ZWQiLCJkcmFnRW5kSGFuZGxlciIsImNvbnNvbGUiLCJsb2ciLCJ0ZXh0Q29udGVudCIsIlByb2plY3RMaXN0IiwidHlwZSIsImFzc2lnbmVkUHJvamVjdHMiLCJkcmFnT3ZlckhhbmRsZXIiLCJ0eXBlcyIsImNsYXNzTGlzdCIsImFkZCIsImRyb3BIYW5kbGVyIiwiZ2V0RGF0YSIsIkZpbmlzaGVkIiwiZHJhZ0xlYXZlSGFuZGxlciIsInJlbW92ZSIsInJlbGV2YW50UHJvamVjdHMiLCJmaWx0ZXIiLCJyZW5kZXJQcm9qZWN0cyIsImxpc3RJZCIsInRvVXBwZXJDYXNlIiwiaW5uZXJIVE1MIiwicHJvamVjdEl0ZW0iXSwic291cmNlUm9vdCI6IiJ9